TTHSD Next åè®®æµ‹è¯•æ•™ç¨‹

ç¯å¢ƒå‡†å¤‡

1. ç¼–è¯‘åŠ¨æ€åº“

bash
Linux
cd /path/to/TTHSDNext
BINDGEN_EXTRA_CLANG_ARGS="-I/usr/lib/gcc/x86_64-linux-gnu/13/include" \
cargo build --release
äº§ç‰©: target/release/libtthsd.so

Windows (éœ€è¦ Visual Studio Build Tools + CMake)
cargo build --release
äº§ç‰©: target/release/tthsd.dll

macOS
cargo build --release
äº§ç‰©: target/release/libtthsd.dylib


2. å®‰è£… Python æ¥å£

å°† scripts/TTHSD_interface.py å¤åˆ¶åˆ°ä½ çš„é¡¹ç›®ç›®å½•ï¼Œä¸åŠ¨æ€åº“æ”¾åœ¨åŒä¸€æ–‡ä»¶å¤¹ã€‚


your_project/
â”œâ”€â”€ tthsd.dll          (Windows)
â”œâ”€â”€ libtthsd.so        (Linux)
â”œâ”€â”€ libtthsd.dylib     (macOS)
â””â”€â”€ TTHSD_interface.py


---

å¿«é€Ÿæµ‹è¯•ï¼ˆæ¨èï¼‰

python
from TTHSD_interface import TTHSDownloader, EventLogger

with TTHSDownloader() as dl:
    cb = EventLogger()
    dl_id = dl.start_download(
        urls=["https://releases.ubuntu.com/24.04/ubuntu-24.04-desktop-amd64.iso"],
        save_paths=["/tmp/ubuntu.iso"],
        callback=cb,
    )
    print(f"ä¸‹è½½å™¨ ID: {dl_id}")
    input("æŒ‰ Enter åœæ­¢ä¸‹è½½...")
    dl.stop_download(dl_id)


---

å„åè®®æµ‹è¯•

ğŸŒ HTTP / HTTPS

è‡ªåŠ¨ä½¿ç”¨ HTTP/3ï¼ˆå¦‚æœåŠ¡å™¨æ”¯æŒï¼‰ï¼Œå¦åˆ™é™çº§åˆ° HTTP/1.1+2ã€‚

python
from TTHSD_interface import TTHSDownloader, EventLogger

with TTHSDownloader() as dl:
    dl.start_download(
        urls=["https://speed.cloudflare.com/__down?bytes=10000000"],  # Cloudflare æ”¯æŒ HTTP/3
        save_paths=["/tmp/cloudflare_10mb.bin"],
        callback=EventLogger(),
    )
    input("ç­‰å¾…ä¸‹è½½å®Œæˆï¼ŒæŒ‰ Enter ç»§ç»­...")


  æ³¨: éªŒè¯ HTTP/3 æ˜¯å¦ç”Ÿæ•ˆï¼š ä¸‹è½½ Cloudflare/Google çš„ URL æ—¶ï¼Œæ§åˆ¶å°ä¼šæ‰“å° æœåŠ¡å™¨æ”¯æŒ HTTP/3ï¼Œä½¿ç”¨ QUIC ä¸‹è½½ã€‚

---

ğŸ“ FTP

python
from TTHSD_interface import TTHSDownloader, EventLogger

åŒ¿å FTPï¼ˆå…¬å…±æµ‹è¯•æœåŠ¡å™¨ï¼‰
with TTHSDownloader() as dl:
    dl.start_download(
        urls=["ftp://ftp.gnu.org/gnu/wget/wget-latest.tar.gz"],
        save_paths=["/tmp/wget-latest.tar.gz"],
        callback=EventLogger(),
    )
    input("ç­‰å¾…å®Œæˆï¼ŒæŒ‰ Enter...")


å¸¦ç”¨æˆ·åå¯†ç çš„ FTPï¼š
python
urls=["ftp://user:password@ftp.example.com/path/to/file.zip"]


---

ğŸ§² BitTorrent / Magnet

python
from TTHSD_interface import TTHSDownloader, EventLogger

Ubuntu å®˜æ–¹ç§å­ï¼ˆåˆæ³•èµ„æºï¼‰
with TTHSDownloader() as dl:
    dl.start_download(
        urls=["magnet:?xt=urn:btih:b7b0fbab74a85d4ac170662c645982a862826455&dn=ubuntu-24.04.2-desktop-amd64.iso"],
        save_paths=["/tmp/ubuntu_bt/"],   # BT ä¸‹è½½ç›®å½•
        callback=EventLogger(),
    )
    input("ç­‰å¾… DHT è¿æ¥ï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰ï¼ŒæŒ‰ Enter åœæ­¢...")


  æ³¨: æ³¨æ„ï¼š BT ä¸‹è½½éœ€è¦ DHT ç½‘ç»œé¢„çƒ­ï¼Œé€šå¸¸ 30-60 ç§’åæ‰å¼€å§‹æ¥æ”¶æ•°æ®ã€‚

ä½¿ç”¨ .torrent æ–‡ä»¶ URLï¼š
python
urls=["https://releases.ubuntu.com/24.04/ubuntu-24.04.2-desktop-amd64.iso.torrent"]


---

ğŸ”— ED2K

python
from TTHSD_interface import TTHSDownloader, EventLogger

ed2k:// é“¾æ¥æ ¼å¼: ed2k://|file|<æ–‡ä»¶å>|<å¤§å°>|<Hash>|/
with TTHSDownloader() as dl:
    dl.start_download(
        urls=["ed2k://|file|ubuntu-24.04-desktop-amd64.iso|2110668800|d9e3c9d5c9f7e4ae4512b4cdf5512345|/"],
        save_paths=["/tmp/ubuntu_ed2k.iso"],
        callback=EventLogger(),
    )
    input("ç­‰å¾…å®Œæˆï¼ŒæŒ‰ Enter...")


  æ³¨: å·¥ä½œåŸç†ï¼š ED2K é“¾æ¥é€šè¿‡ https://ed2k.lyoko.io/hash/<hash> ç½‘å…³è½¬ä¸º HTTP ä¸‹è½½ï¼Œæ— éœ€å®‰è£… eMule å®¢æˆ·ç«¯ã€‚

---

ğŸ“‹ Metalink

python
from TTHSD_interface import TTHSDownloader, EventLogger

Metalink 4.0 (.meta4) â€” åŒ…å«å¤šä¸ªé•œåƒ URL
with TTHSDownloader() as dl:
    dl.start_download(
        urls=["https://www.mirrorservice.org/sites/download.eclipse.org/eclipseMirror/technology/epp/downloads/release/2024-09/R/eclipse-java-2024-09-R-linux-gtk-x86_64.tar.gz.meta4"],
        save_paths=["/tmp/eclipse.tar.gz"],
        callback=EventLogger(),
    )
    input("ç­‰å¾…å®Œæˆï¼ŒæŒ‰ Enter...")


  æ³¨: å·¥ä½œåŸç†ï¼š ä¸‹è½½å™¨å…ˆè·å– .meta4 XML æ–‡ä»¶ï¼Œè§£æå‡ºæ‰€æœ‰é•œåƒ URLï¼Œé€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„é•œåƒä¸‹è½½ã€‚

---

ä¸€é”®ç»¼åˆæµ‹è¯•è„šæœ¬

python
#!/usr/bin/env python3
"""TTHSD åè®®ç»¼åˆæµ‹è¯•"""

import time
import threading
from TTHSD_interface import TTHSDownloader, EventLogger

TESTS = [
    {
        "name": "HTTP (Cloudflare, æµ‹è¯• HTTP/3 æ¢æµ‹)",
        "url": "https://speed.cloudflare.com/__down?bytes=1000000",
        "save": "/tmp/test_http.bin",
    },
    {
        "name": "FTP (GNU å…¬å…±æœåŠ¡å™¨)",
        "url": "ftp://ftp.gnu.org/gnu/hello/hello-2.12.1.tar.gz",
        "save": "/tmp/test_ftp.tar.gz",
    },
    {
        "name": "Magnet (Ubuntu BT)",
        "url": "magnet:?xt=urn:btih:b7b0fbab74a85d4ac170662c645982a862826455",
        "save": "/tmp/test_bt/",
        "timeout": 60,
    },
]

results = {}

def run_test(name, url, save, timeout=30):
    done = threading.Event()
    success = [False]

    def cb(event, msg):
        t = event.get("Type", "")
        if t == "end":
            success[0] = True
            done.set()
        elif t == "err":
            done.set()

    try:
        with TTHSDownloader() as dl:
            dl_id = dl.start_download(urls=[url], save_paths=[save], callback=cb)
            done.wait(timeout=timeout)
            if not success[0]:
                dl.stop_download(dl_id)
    except Exception as e:
        print(f"  âŒ å¼‚å¸¸: {e}")
        return False

    return success[0]

for t in TESTS:
    print(f"\n{'='*50}")
    print(f"æµ‹è¯•: {t['name']}")
    print(f"URL:  {t['url'][:60]}...")
    ok = run_test(t["name"], t["url"], t["save"], t.get("timeout", 30))
    results[t["name"]] = ok
    print(f"ç»“æœ: {'âœ… é€šè¿‡' if ok else 'âŒ å¤±è´¥'}")

print(f"\n{'='*50}")
print("ç»¼åˆæµ‹è¯•æŠ¥å‘Š:")
for name, ok in results.items():
    print(f"  {'âœ…' if ok else 'âŒ'} {name}")


---

æ§åˆ¶æ“ä½œ

python
with TTHSDownloader() as dl:
    dl_id = dl.start_download(urls=[url], save_paths=[save], callback=cb)

    time.sleep(5)
    dl.pause_download(dl_id)    # æš‚åœ
    print("å·²æš‚åœ")

    time.sleep(3)
    dl.resume_download(dl_id)   # æ¢å¤
    print("å·²æ¢å¤")

    time.sleep(2)
    dl.stop_download(dl_id)     # åœæ­¢ï¼ˆä¸å¯æ¢å¤ï¼‰
    print("å·²åœæ­¢")


---

å¸¸è§é—®é¢˜

| ç°è±¡ | åŸå›  | è§£å†³ |
|:---|:---|:---|
| åŠ¨æ€åº“æ–‡ä»¶ä¸å­˜åœ¨ | æœªç¼–è¯‘æˆ–è·¯å¾„é”™è¯¯ | å…ˆ cargo build --release |
| FTP ä¸‹è½½å¤±è´¥ | æœåŠ¡å™¨æ‹’ç»åŒ¿åç™»å½• | åœ¨ URL ä¸­å¸¦ä¸Š user:pass@ |
| BT é•¿æ—¶é—´æ— è¿›åº¦ | DHT ç½‘ç»œå†·å¯åŠ¨ | ç­‰å¾… 1-3 åˆ†é’Ÿï¼ŒPeer ä¼šé™†ç»­è¿æ¥ |
| HTTP/3 æœªè§¦å‘ | æœåŠ¡å™¨ä¸æ”¯æŒ QUIC | æ­£å¸¸ï¼Œè‡ªåŠ¨é™çº§åˆ° HTTP/2 |
| ED2K ä¸‹è½½å¤±è´¥ | ç½‘å…³æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ | æ£€æŸ¥ ed2k.lyoko.io è¿é€šæ€§ |
| Windows ç¼–è¯‘å¤±è´¥ | ç¼ºå°‘ BoringSSL ä¾èµ– | å®‰è£… VS Build Tools 2022 + CMake |
